{
  "info": {
    "name": "Scary Mafia Backend Tests",
    "description": "Complete API testing collection for the Mafia game backend",
    "version": "1.0.0"
  },
  "variables": [
    {
      "name": "baseUrl",
      "value": "http://localhost:8000"
    },
    {
      "name": "testUserId1",
      "value": ""
    },
    {
      "name": "testUserId2", 
      "value": ""
    },
    {
      "name": "testRoomId",
      "value": ""
    },
    {
      "name": "testGameId",
      "value": ""
    }
  ],
  "folders": [
    {
      "name": "1. Infrastructure Tests",
      "items": [
        {
          "name": "Test Redis Connection",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/redis/test"
          }
        },
        {
          "name": "Get Redis Status",
          "request": {
            "method": "GET", 
            "url": "{{baseUrl}}/redis/status"
          }
        },
        {
          "name": "Redis Ping",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/redis/ping"
          }
        }
      ]
    },
    {
      "name": "2. Authentication Tests",
      "items": [
        {
          "name": "Register User 1",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/auth/signup",
            "headers": {
              "Content-Type": "application/json"
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userEmail\": \"test1@example.com\",\n  \"password\": \"password123\",\n  \"nickname\": \"testplayer1\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('testUserId1', response.userId);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Register User 2",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/auth/signup",
            "headers": {
              "Content-Type": "application/json"
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userEmail\": \"test2@example.com\",\n  \"password\": \"password123\",\n  \"nickname\": \"testplayer2\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('testUserId2', response.userId);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Login User 1",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/auth/login",
            "headers": {
              "Content-Type": "application/json"
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userEmail\": \"test1@example.com\",\n  \"password\": \"password123\"\n}"
            }
          }
        },
        {
          "name": "Login User 2",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/auth/login",
            "headers": {
              "Content-Type": "application/json"
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userEmail\": \"test2@example.com\",\n  \"password\": \"password123\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "3. User Management Tests",
      "items": [
        {
          "name": "Get All Users",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/users/list"
          }
        },
        {
          "name": "Get User by ID",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/users/userId/{{testUserId1}}"
          }
        },
        {
          "name": "Get User by Nickname",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/users/nickname/testplayer1"
          }
        },
        {
          "name": "Get User by Email",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/users/email/test1@example.com"
          }
        },
        {
          "name": "Get User Count",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/users/count"
          }
        }
      ]
    },
    {
      "name": "4. Room Management Tests",
      "items": [
        {
          "name": "Create Room",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/rooms",
            "headers": {
              "Content-Type": "application/json"
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Test Mafia Game\",\n  \"notes\": \"Testing room creation\",\n  \"hostUserId\": \"{{testUserId1}}\",\n  \"requiredPlayers\": 8\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('testRoomId', response.roomId);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Room Info",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/rooms/{{testRoomId}}"
          }
        },
        {
          "name": "Join Room",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/rooms/{{testRoomId}}/join",
            "headers": {
              "Content-Type": "application/json"
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{testUserId2}}\"\n}"
            }
          }
        },
        {
          "name": "Get Room Participants",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/rooms/{{testRoomId}}/participants"
          }
        },
        {
          "name": "Check if Game Can Start",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/rooms/{{testRoomId}}/can-start"
          }
        },
        {
          "name": "Get User's Current Room",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/rooms/current/{{testUserId1}}"
          }
        }
      ]
    },
    {
      "name": "5. Game Logic Tests",
      "items": [
        {
          "name": "Get Game State",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/game-logic/state/{{testRoomId}}"
          }
        },
        {
          "name": "Get Public Game State",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/game-logic/public-state/{{testRoomId}}",
            "headers": {
              "Content-Type": "application/json"
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{testUserId1}}\"\n}"
            }
          }
        },
        {
          "name": "Start First Night",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/game-logic/start-night/{{testRoomId}}"
          }
        },
        {
          "name": "Transition to Night Result",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/game-logic/transition-night-result/{{testRoomId}}"
          }
        },
        {
          "name": "Transition to Day",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/game-logic/transition-day/{{testRoomId}}"
          }
        },
        {
          "name": "Transition to Vote",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/game-logic/transition-vote/{{testRoomId}}"
          }
        },
        {
          "name": "Transition to Day Result",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/game-logic/transition-day-result/{{testRoomId}}"
          }
        },
        {
          "name": "Check Win Conditions",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/game-logic/check-win/{{testRoomId}}"
          }
        }
      ]
    },
    {
      "name": "6. Game Management Tests",
      "items": [
        {
          "name": "Create Game",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/games",
            "headers": {
              "Content-Type": "application/json"
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"started_at\": \"2024-01-01T10:00:00.000Z\",\n  \"ended_at\": \"2024-01-01T11:00:00.000Z\",\n  \"winner_team\": \"citizen\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('testGameId', response.gameId);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Get All Games",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/games/list"
          }
        },
        {
          "name": "Get Game Count",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/games/count"
          }
        },
        {
          "name": "Get Game by ID",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/games/{{testGameId}}"
          }
        }
      ]
    },
    {
      "name": "7. Game Participants Tests",
      "items": [
        {
          "name": "Create Game Participant",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/game-participants",
            "headers": {
              "Content-Type": "application/json"
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"gameId\": \"{{testGameId}}\",\n  \"userId\": \"{{testUserId1}}\",\n  \"role\": \"citizen\",\n  \"isWinner\": true\n}"
            }
          }
        },
        {
          "name": "Get Participants by Game",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/game-participants/game/{{testGameId}}"
          }
        },
        {
          "name": "Get Participant Games by User",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/game-participants/user/{{testUserId1}}"
          }
        },
        {
          "name": "Get User Statistics",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/game-participants/user/{{testUserId1}}/stats"
          }
        }
      ]
    },
    {
      "name": "8. Cleanup Tests",
      "items": [
        {
          "name": "Leave Room",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/rooms/{{testRoomId}}/leave",
            "headers": {
              "Content-Type": "application/json"
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{testUserId2}}\"\n}"
            }
          }
        },
        {
          "name": "Delete Room",
          "request": {
            "method": "DELETE",
            "url": "{{baseUrl}}/rooms/{{testRoomId}}"
          }
        }
      ]
    }
  ]
} 